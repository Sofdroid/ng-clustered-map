"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="clustered.map"),function(e,r,t){"use strict";r.module("clustered.map",[]).factory("google",["$window",function(e){if(e.google===t||e.MarkerClusterer===t)throw new Error("google is not bound to window");return{maps:e.google.maps,MarkerClusterer:e.MarkerClusterer}}]).factory("utils",function(){return{getCenter:function(e){var r={x:0,y:0},t=0;return e.map(function(e){r.x+=e[0]*e[2],r.y+=e[1]*e[2],t+=e[2]}),r.x/=t,r.y/=t,r},getCalculator:function(e,r){for(var t=0,n=0;n<e.length;n++)t+=e[n].weight;return{text:t,index:Math.min(String(t).length,r)}}}}).directive("clusteredMap",["google","utils",function(e,t){return{restrict:"EA",replace:!0,template:'<div id="map_canvas"></div>',scope:{markers:"=",zoom:"=",center:"="},link:function(n,o){function a(a){var i=n.center||{x:0,y:0};n.center||(i=t.getCenter(a));for(var u=new e.maps.LatLng(Math.floor(i.x),Math.floor(i.y)),l=r.element(o[0])[0],s=new e.maps.Map(l,{zoom:n.zoom||2,center:u,mapTypeId:e.maps.MapTypeId.ROADMAP}),c=0;c<a.length;++c)a[c]=new e.maps.Marker({position:new e.maps.LatLng(a[c][0],a[c][1]),weight:a[c][2],title:"weight:"+a[c][2]});var p=new e.MarkerClusterer(s);p.setCalculator(t.getCalculator),p.addMarkers(a)}n.$watch(function(){return n.markers},function(){n.markers&&a(n.markers)})}}}])}(window,window.angular);