"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="clustered.map"),function(e,r,t){"use strict";r.module("clustered.map",[]).factory("google",["$window",function(e){if(e.google===t||e.MarkerClusterer===t)throw new Error("google is not bound to window");return{maps:e.google.maps,MarkerClusterer:e.MarkerClusterer}}]).directive("clusteredMap",["google",function(e){return{restrict:"EA",replace:!0,template:'<div id="map_canvas"></div>',scope:{markers:"=",zoom:"=",center:"="},link:function(t,o){function n(n){var a=t.center||{x:0,y:0},i=0;if(!t.center){for(var s=0;s<n.length;s++)a.x+=n[s][0]*n[s][2],a.y+=n[s][1]*n[s][2],i+=n[s][2];a.x/=i,a.y/=i}for(var l=new e.maps.LatLng(Math.floor(a.x),Math.floor(a.y)),u=r.element(o[0])[0],p=new e.maps.Map(u,{zoom:t.zoom||2,center:l,mapTypeId:e.maps.MapTypeId.ROADMAP}),s=0;s<n.length;++s)n[s]=new e.maps.Marker({position:new e.maps.LatLng(n[s][0],n[s][1]),weight:n[s][2],title:"weight:"+n[s][2]});var d=function(e,r){for(var t=0,o=0;o<e.length;o++)t+=e[o].weight;return{text:t,index:Math.min(String(t).length,r)}},m=new e.MarkerClusterer(p);m.setCalculator(d),m.addMarkers(n)}t.$watch(function(){return t.markers},function(){t.markers&&n(t.markers)})}}}])}(window,window.angular);